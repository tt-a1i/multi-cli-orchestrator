# v0.1.0 - 最小可用版本

日期：2026-02-26

## 版本范围

`v0.1.0` 提供可落地的多 Provider 编排基线能力：
- 统一入口：`mco review` 与 `mco run`
- 5 家 Provider 适配：`claude`、`codex`、`gemini`、`opencode`、`qwen`
- `wait-all` 并行分发 + 幂等/重试语义
- `review` 模式下的结构化解析合同门禁 + canonical findings 产物输出
- GitHub Actions 中的 gate 与 benchmark 工作流

## 安装与运行

## 前置依赖

- Python 3.11+
- `jq` 与 `ripgrep`
- 至少一款已登录的 Provider CLI：
  - `claude`
  - `codex`
  - `gemini`
  - `opencode`
  - `qwen`

## 克隆与启动

```bash
git clone git@github.com:tt-a1i/mco.git
cd mco
./mco review --repo . --prompt "Review for bugs." --providers claude,codex --json
```

通用执行模式：

```bash
./mco run --repo . --prompt "总结当前仓库架构。" --providers claude,codex --json
```

## 配置说明

基础配置示例（`mco.example.json`）：

```json
{
  "providers": ["claude", "codex", "gemini", "opencode", "qwen"],
  "artifact_base": "reports/review",
  "state_file": ".mco/state.json",
  "policy": {
    "timeout_seconds": 180,
    "max_retries": 1,
    "high_escalation_threshold": 1,
    "require_non_empty_findings": true,
    "max_provider_parallelism": 0,
    "allow_paths": [".", "runtime", "scripts"],
    "enforcement_mode": "strict",
    "provider_permissions": {
      "claude": {"permission_mode": "plan"},
      "codex": {"sandbox": "workspace-write"}
    },
    "provider_timeouts": {
      "claude": 300,
      "codex": 240
    }
  }
}
```

按配置运行：

```bash
./mco review --config ./mco.example.json --repo . --prompt "Review for security and reliability risks."
```

## 产物目录

每次任务会写入 `<artifact_base>/<task_id>/`：
- `summary.md`
- `decision.md`
- `findings.json`
- `run.json`
- `providers/*.json`
- `raw/*.log`

门禁与基准报告输出在：
- `reports/adapter-contract/<date>/`

## 常见问题

1. Provider 不可用（`detected=false` 或 `auth_ok=false`）
- 先确认 CLI 已安装且登录。
- 先跑对应 Provider 的 auth/status 命令自检。

2. `parse_success_count` 高，但 findings 偏少
- 这是正常现象之一。
- 请区分：
  - 解析健康度：`parse_success_count`、`providers_total`、`parse_success_rate`
  - 有效发现数：`effective_findings_count`、`zero_finding_provider_count`

3. 超时导致 `PARTIAL_SUCCESS`
- 通过 `provider_timeouts` 或 `--provider-timeouts` 提升指定 Provider 超时。
- 当前默认已对 `claude/codex` 做了基础超时画像，但大仓库仍可能需要更高值。

4. YAML 配置加载失败
- 安装 `pyyaml`，或直接使用 `.json` 配置。

## FAQ

Q: 为什么 parse 成功数量和 findings 数量会不一致？  
A: parse 只验证结构合同是否可解析；findings 还会经过 schema/drop 过滤。

Q: `mco review` 和 `mco run` 的区别是什么？  
A: `review` 强制 findings 合同并给出决策；`run` 是面向 agent 编排的通用执行聚合模式。

Q: `allow_paths` 是否等同于操作系统级沙箱？  
A: 不是。`allow_paths` 由 orchestrator 做路径校验与策略约束；真正的沙箱能力取决于各 Provider 支持的权限参数。

Q: `max_provider_parallelism=0` 表示什么？  
A: 对已选 Provider 全并行执行。

Q: 某个 Provider 失败会不会中断整次任务？  
A: 不会。执行模型是 `wait-all`，终态可能是 `PARTIAL_SUCCESS`。

Q: 这个版本是否可用于生产？  
A: `v0.1.0` 是最小可用基线，建议配合仓库级策略与安全规则一起上线。
